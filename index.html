<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Eric & Darya: Wedding Chase</title>
  <style>
    :root{ --bg1:#0f172a; --bg2:#1e293b; --text:#e5e7eb; --shadow:rgba(0,0,0,.35); }
    *{box-sizing:border-box}
    html,body{
      height:100%; margin:0;
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text);
    }
    .wrap{display:flex;align-items:center;justify-content:center;height:100%;padding:16px}
    canvas{
      width:min(100%,900px); aspect-ratio:9/16;
      border-radius:20px; box-shadow:0 20px 60px var(--shadow);
      background:linear-gradient(180deg,#60a5fa,#e0f2fe); touch-action:none
    }
    .hud{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:10;}
    .hud[hidden]{display:none !important;}
    .card{
      background:rgba(17,24,39,.85); backdrop-filter:blur(8px);
      border:1px solid rgba(255,255,255,.08);
      padding:20px 22px; border-radius:16px; width:min(92vw,560px);
      box-shadow:0 10px 40px var(--shadow)
    }
    .title{font-size:24px;font-weight:800;margin:0 0 6px;text-align:center}
    .subtitle{font-size:14px;opacity:.8;text-align:center;margin:0 0 14px}
    .btnrow{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
    button{
      background:#fff;color:#111;font-weight:700;padding:12px 18px;border-radius:999px;border:0;cursor:pointer;
      box-shadow:0 8px 24px var(--shadow)
    }
    button.secondary{background:transparent;color:#fff;border:1px solid rgba(255,255,255,.2)}
    .small{font-size:12px;opacity:.9;text-align:center;margin-top:8px}
    fieldset{border:1px solid rgba(255,255,255,.15); border-radius:12px; padding:10px 12px; margin:10px 0}
    legend{font-size:12px; opacity:.8; padding:0 6px}
    .top-center{position:fixed;left:50%;transform:translateX(-50%);top:10px;font-weight:800;z-index:2}
    .top-right{position:fixed;right:14px;top:10px;opacity:.9;z-index:2}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.12);margin-left:6px}
    .popScore{
      position:fixed; left:50%; transform:translateX(-50%);
      top:58px; font-size:56px; font-weight:900; color:#fff;
      text-shadow:0 6px 24px rgba(0,0,0,.35);
      opacity:0; pointer-events:none; z-index:2;
    }
    .popScore.show{ animation:pop 750ms ease-out forwards; }
    @keyframes pop{
      0% { transform:translateX(-50%) scale(.6); opacity:0 }
      20%{ opacity:1 }
      60%{ transform:translateX(-50%) scale(1) }
      100%{ opacity:0 }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <canvas id="game" width="900" height="1600" aria-label="Game canvas"></canvas>
  </div>

  <div class="top-center">Tubes: <span id="tubeCount">0</span> <span class="pill">Best: <span id="best">0</span></span></div>
  <div class="top-right"><span class="pill">Tap/Click/Space to flap · P to pause · R to restart</span></div>
  <div id="pop" class="popScore">1</div>

  <div class="hud" id="menuHud">
    <div class="card">
      <h1 class="title">Eric &amp; Darya: Wedding Chase</h1>
      <p class="subtitle">Flap through pipes as <strong>Eric</strong>; don’t let <strong>Darya</strong> catch you!</p>

      <fieldset>
        <legend>Difficulty</legend>
        <label><input type="radio" name="diff" value="Easy"> Easy</label>
        <label style="margin-left:10px"><input type="radio" name="diff" value="Normal" checked> Normal</label>
        <label style="margin-left:10px"><input type="radio" name="diff" value="Hard"> Hard</label>
        <div class="small" style="margin-top:6px;opacity:.8">
          Easy = bigger gaps & slower chase · Hard = tighter gaps & faster chase
        </div>
      </fieldset>

      <div class="btnrow">
        <button id="btnPlay" type="button">Start</button>
        <button class="secondary" id="btnHow" type="button">How to play</button>
      </div>
      <p class="small" id="howText" hidden>
        Fly between pipe gaps to score. If you hit a pipe, the ground, or if Darya catches you, it’s game over.
        Choose your difficulty above — it’ll be remembered for next time.
      </p>
    </div>
  </div>

  <div class="hud" id="overHud" hidden>
    <div class="card">
      <h2 class="title">Game Over</h2>
      <p class="subtitle" id="overMsg">So close! Wanna try again?</p>
      <div class="btnrow">
        <button id="btnRetry" type="button">Play again</button>
        <button class="secondary" id="btnMenu" type="button">Main menu</button>
      </div>
      <p class="small">Tip: quick restart with the <strong>R</strong> key.</p>
    </div>
  </div>

  <script>
  (()=> {
    const ERIC_FACE_DATA_URL = "data:image/webp;base64,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";
    const DARYA_FACE_DATA_URL = "data:image/webp;base64,UklGRuAQAABXRUJQVlA4INQQAADwSgCdASqgAKAAPm0ykkckIyGhKpVbsIANiWcAxYpzXhYtV9rZKe4PCF018I/P0En2f6kdiLmYP4ds2tDKl5x5sXmj7PLakf1gtnk5PXfeamnN92TgqCBns7XoaYcRDGRxHZIT0WBytoIngUOqHX7EjXYkIDzFFNDqpUsAGKnEG7+qR6jmTvonLWB/MR2Vw3M6IxKQT7RaLxF4n1LSK3ktjfyg6M5b+f5ZsNhMKozU1/ZKsgQ/8+h7akrnednAWOtgt4gvHEgZhwjpoVgan/wlyTpQwmaB0LTEHO2TlDwXwoFOgu8a73XqPpv6KR4s99N74W/yl2nu84hLX5y35+6UIoZEI3NHjICVUmoCGpwpD9OLS24qGuFmtf2YBIsuzCa5wVGAgy+WcVloa8CQnzSvx74UErd7UXfxGqPS5ylRLfaj14dM284z5QswPNn0/71i+gMg7WB9w4BgkzNQYCxxi7cxYY0UPIE0qBs7b2/UyJnSj/wB8XCxPph2T/XRCzZlAA0mmZM0JNHdVOzbkRKpEXQ0tUfRkGyL02sOBfPkIjbFrK5nICfH1LxJ4Ek+U+X3r0H133sKThJCjwdUr9droL0Xk5WjBxpejFnL3yrLDjQfS0cHsOmcX2u1H2lZq3OjEAlzA26+PDhz9T9VuMfXrK3hR7kLKKzc+1vVEJ01e9cnGjt6edyKUaDtuNbljOQHaxbWr+qNWNlnozh/joZe+a9sO0DUz09Xz7i6+exYA9cpwYg60IYlf2ykW0dwsLUYptygMe9c45ZG8cAfAAVBmxEfwhfLcY1hDkbRS4HKcAD+/VbwXn8unn09dd1jlAkSdJjDOxcDI61VKqIfTf63Kie/vlGZ3Yebjz7a1M3zBMBV5UIRjaxdWMzD1Yz46gAu06NGS4vMq+JjdtaFKntr3/HZvcY8h7R1DyIVqnJi7KLMfKy0P/+Ru/fndh+R0YpzFGNeiTmaHh9++dHjMH88EOh+MZ663lSgzKu7I0gmoTd4dw+bcH7o2e6zhpXixVINBDu0gF83poByFutH03CoCEKZpcIMKXVOHJW1noVpKIbeHRUNvt62utI8zNOazfyNEfGMHym2W5p+PrkcehQIpmGkoRW1BMTw+WqWq4uVS5e7G44wMuMyM6OwI7YTEumRrsxgI0AX5iPwRLbzuzBFNsLiLnR03P/1z6vAPU58uS64ZbIDmJipwihLLjQWfov4H/fMIIfsaKB+orOOBd5wq8QIoYIKhIcZeMESV7aXr2z7pkduV8gx6e4Tv4x59VN4cTqcL6Mn+E/5t8dC5L/nuGft57uMCrCu0wXFeJaw/jZDpLExozTZCm6cHmTxQKqYcqhkKOvv1nJ9fgQjoYGRKBIaF/1GiBrs+j7ttu0OUubd9jWIv5JylBGeyFpAQlINNIPUYYvU1HTYt3/KhCUU8qa9IEWXRG5ctOFua5OotIHVKUERwBeFK5CdbjlNTcr9n7axFyHmeimUoHdovR2Fisa3fZ1DK5l+xwB/spusOt/IxWovesEalxA5vKdhZ23P/d13+d7kxjEXuQMpt2/WMmLwFHihIfUSYO+54k62Of/qxzrSuv1POq+nPy30YqqOEK8la/oSVLZoaqOlWFN7PyEyhRd6y6HwO8jvw2ldDdWuFBlvL+CrxUVWh84mHi8GUop2xXZHDH8MlVJ4En/krYZYqcZ0A+psOHIsq5dqT7HTEBwnNz7Ygzxr/6OwVoh68HVfGyhnTczLcKW41YcBzBKkWxKCFWUEuUhy3sO172AEToY7GUOkXDzr+gs5LpBwtcjJRUX8EkJ/3mvrN2f5CO63uKdzZjq5F5SgP9Nk1z4AiQC8yFwnvfYZDLo+SDVeiFyArybecYul+r85oFaFxse1P3nwngS/lCPtDdSQ0IU3ZDJvTrluEyC2UUlZ5HbFlE1ow4sLDjCrneoSbnPHa/956I++nVtMt/Yr46j2v0k8dE4j+Uge6WkeSaYEMDpPVv18JGK7bhYL71hjEm8XsAzTLj+ufJMBbIRD2aDFzc6J0usNCKTBNEouaLGM9BCfmwUUM51yajjbU9iW4zrKVcz7gdjnqvQ0Ic6uQ9D6efgjfuwNS6hcy2OIMCkyUBjZvFW3LreVSLdHg/dbKwhYm6yZzYnECW2Hpb8ywgtnO55Zz3/bhaj4p+GOtspvSscr4QHWPLZDz6k6Sx0y4FlKwkGzerNYt4m5G/e8R+l2pvF9pc03rUGsRACoRJXi3cX4J7nyJHQwxKhZ3AEu+CeaJaMJbAFjYZBGjVAwjBHss+KqoXEdwxMz4RpvgnFvsvBDy/VBBMcp+GjIqiIpldU51KYxhqKpAqNCAwntCRDJgiK+s9CKus4oyPXe2fOcsOkeTnAOnTXW5a3F1XjeVNrO5/P4hv5ShPwh346rtpgRL6UnhIwiBYoSHS7v4M6aEmN6wvibHcf+jeqqNPIKfv/+I+N5I5maKkYrL0U48u601frzXN/lmlglnx0nI/Ni7wtqndMoT3r2bVy+xleHrNo0QtTrQLQUTK5dcpi7Icy+R3XnVEArsq+5w9Ealc1/my/tSGH3qD1QIgIqn769PU1aE4hKAbr4lH+79PDoqWQGWayqqsgSe9KzaeoAPz0hEV4eD7W5nr3gFfCNLntum0haqf7OPmMEl+RRXJWyVTYD5EU5xrxiRuxnLajQXMggRID5p5MKGUhQ8TJ2IfPMrAbmC/lEqXcenWYOVwh8bbXnjSN1kgV4tdTzvCpdS9KSH/NYgYFOXo+wqoV/6MBkyvGo/lzGUkhtePLPSt6mVfLemGrWctDcwz371oOTAlq2nk1w8u3A8Wt5/CkQRJIwvXlFEkwYA5KtRN2xxfJGuW7keR2Ljt38/IV3apOVH0GghUUIDTTKZaZfvbm4fLLiFYBuwTpwyNMmJ3wRKA3hwg8sT9BqJpL1aHI2/knFtgvt8X4KctDBT6D0YtAjUdfZ3DJRKqliwgfjPFrkQwbYdh5P1An1rjjDj/3oBaZ39kqlfMDpVio1r8REr98a4LAUEwOEvyMzClsyd0H5It1sRzKLfN54e+yMvKgp9wRv7e/jL7RAzKxdkAbV+X3URzDikWQBJ9WRVibqVA4t/6YIHAL5/r7OLn4e9MUH9vtudI2IuryJ4AONaxbrUBMXIuQoLJt8VyLw1HvA7/MUi90Y/eGcSBIzU0CCCZ2VaFiH/tFF3DIgoJE8jGiDdlc3izhHVNhyME8AD1iJQPzfTUy1861F02Wyoaob8cu59itI4hO3HU0sLMYvLX/M4+neX+eUDdJZtKp4Rfm4Qe449nw6YAWQDHy9I2T1XEgGFoiJDAaVeBzOf6mnEhcBJCv0PNbeg+52xFy5zsLILUSkPoqXK+QGTXSADNXhxN2gTe3Nru8Xk4B7r0LL65YHee9ojL+B6aTu5K00POEtmoXH6EK2s/xzz+S7CQAgxVISL0NEO3SCO+35QfMTIkNt+RVHHDrfRCN3CEei3Jy4bTYp6sSQJmCO3DyTYYntBzv5ICUx2DEi6jr9BJ5SyXRv1nsD3b0m83uwqtk3bfIcPygjWyY/gJyJKLXQylNGEB9Utic/RR859m816Q2bQMr58xnr02khC+LzdQrWzuLbzGShf3b1q9x1VTKwpc89e7/LcsKzH2Rm4iu2B3ijiJzNJlbaRtLlu+1JPbk+BN+e37FRr4AGzPqvc521gMQg4zykHk+33n2IYfyRSsa26zSNvzNw7uSAhXAGvYw5kaqZqmK1F6PwMmDJsdWMwDjggKIqeoAc3lid7aJ95rzkW7pfbIEVHrUCjsNFbGq1Exquh+YruNWsDmJRIC/ozNI8+2XAtMLCdsPNmUnJv6Ypc3myDybsO8xyqU6xxcQEGgfGRu+6fTF1ECEMtW9udUfkYKldeSa3OVvDbp76XPoXzd/cUwWt94+RoKXpJRI51XBAf+YPxzzB33BeWtCh7cfPKcGih9q+s2Ejv/59iPHqhJV+gDgoWJ1O8ermqtVEjwOfWws4H9kAmLp3pUsM6K6jizA+F/TBr+xy9NqbU5GHW9AcX2gbN0raZypqjCZPHCpbbWC4np6xL/kCuLtLc4vo4Eo7trVYleIRAgBOD3nNV8PC0K+SwTbK9u6wdkAf6cYK1yBGigHlIFSM5iUj3lmDDyBymSUyuntmwDd9Fp3q4wNJ0fr+eos7LuS0fNDkCm0012vfH9LGdTqpJH0XmigNVOC0ug+zFWskJ5aNqUVwqPhtZ/acfAaIz+bQ9fSUbrU+ulogZsEUQen5dQSHauKXVOgs9eSNvypBD1QJ1tA8YJ2maEuaiEkUlcXhVrSif5fRhfY+546YJf70w241beY64wntzCUWSKGvnTXG7Pw1tdqp+L/ZmgDnXDMxBPTS9xsv6ZaBCQ/6o+EP/YXt2L02sA4R518YMm3qsskMTLUfJAv8OVVtTKLE0LtF9I+kBgRStNqtF4KIiLkRTXHsXVRRZA8CeFXnPdZWq8RQDdb8Pmu6WepB8tcWkco0jpM7rBw1Zp+aTZHPHOpSV5DZ/dG+DkHVp3PWMbSRfrVEWebP7IzNQlu0AdSGcWGBXoIrNX4hJqo65QJ2D8wJi4sg6ZE/ArcCpMomx9ZsR88lufz9wXH9diesgKvF7S+dbzfi/dtyrOx7fGLmX4baDVwR19A4U26JZhtiPBwrNheTbYVKo5flpgwkNxyuTCNC+WsC3b/mqnPTwwJiCDigN3fq3q/qAdrGIuISkIWle95fb8DWZ9bafFjY236lBMszeHJaLEQr1PuD8HF4iqzIkmosx+fZzcDwg4MgDRtOgRFl0ykfoal5h+rr2Cqs7E56hmrg/Oer+l1Rlp/FovzqsNx910TVIQBe6m1MFVUH26yjDoQ80t6Dy8G5wADC/ucFbHiIAcJ6w9YSBRxwNP9/vYKVeb+V42SZxryAEllqv72t85BcT54eCbiesY52RPRRC8gl6pVjXa21LtHZ2MTvbrUncuVpdsefmZ6VZ0iSa6OBLkhEb1qXUUeAXVSGw4CXGyOwHy/Q3chhIlu6wCzZHlA4ppYDx/YLRdSTIyAeuCvdczi9UkjYn0CV7aHNOZVb6o1ppMUYb7lhaA69feU/g6slC+nWiGYBz9Ghmu6H+nNbWhAbr4QbPPxZ1zYXvqDT0IRhw7olPjAIx2nXAPrs2xNN+B6wUjuUP24+MKL/udYeemnrr0by1LmAEoq3UQG/TY9ACNcxrucq6xBpbGHeF/P8c4WaN2WCIcIr+jaGBcAC6NTO6EB7OWgPaSxIct7SVALaRRinLzjxrfD+cfGz101WinTQs3QGhJPdZypip4oOZsa9H9a5f+TOWxv7EKaGantBpFswrwgovFh0YxCGFN+elk0FQLYXPhCBbc3B/uYP+cBepAInqaIUn90BBhz6SIh43gk9isNBQF5GtgoZbgl21NKI7NpCDat+eJEDOeoukAYh2dhZHYB57OpntmfF7D3NOxTNUODt5QiCCUJtXklHSycD6Q90TjMTYhbS7qgMYDJjfIgvMYswvjlfD6LGkbCuwqwYXniEDkruy5uEMB7+mK7mDBaPN1wn0cs8omHv+nk8QJIwk1UydWzS+RHCl15qDcljZko2Z+oJKCFqj/kaCP4SNwci6hyehrONe8K1glqwRsDI/AYJ2RJL6jBLW4XcCyGTAeMVaqcYxTRO4Vr56TtjVuoTIyZefVv6Mp8XCwORb19j7vyO43rBdNr40C+o+N+RaIo1zSIpRKY6a1wrAAA=";

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const tubeCountEl = document.getElementById('tubeCount');
    const bestEl  = document.getElementById('best');
    const menuHud = document.getElementById('menuHud');
    const overHud = document.getElementById('overHud');
    const overMsg = document.getElementById('overMsg');
    const popEl   = document.getElementById('pop');
    const diffRadios = Array.from(document.querySelectorAll('input[name="diff"]'));

    const DPR = Math.max(1, Math.min(window.devicePixelRatio || 1, 2));
    function resize(){
      const w = Math.min(window.innerWidth - 32, 900);
      const h = Math.round(w * 16/9);
      canvas.style.width = w + 'px';
      canvas.style.height = h + 'px';
      canvas.width  = Math.floor(w * DPR);
      canvas.height = Math.floor(h * DPR);
    }
    addEventListener('resize', resize, {passive:true}); resize();

    const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
    const rand=(a,b)=>a+Math.random()*(b-a);

    const DIFFS = {
      Easy:   { gapMin:320, gapMax:380, interval:2100, daryaGain:0.00045, pipeSpeed:0.25 },
      Normal: { gapMin:260, gapMax:320, interval:1900, daryaGain:0.00060, pipeSpeed:0.26 },
      Hard:   { gapMin:200, gapMax:240, interval:1500, daryaGain:0.00075, pipeSpeed:0.29 },
    };
    let currentDiff = localStorage.getItem('weddingChase.diff') || 'Normal';
    if (!DIFFS[currentDiff]) currentDiff = 'Normal';
    diffRadios.forEach(r => r.checked = (r.value === currentDiff));
    diffRadios.forEach(r => r.addEventListener('change', () => {
      if (r.checked) {
        currentDiff = r.value;
        localStorage.setItem('weddingChase.diff', currentDiff);
      }
    }));

    let PIPE_GAP_MIN=260, PIPE_GAP_MAX=320, PIPE_INTERVAL=1900, PIPE_SPEED=0.26, DARYA_GAIN=0.0006;
    function applyDifficulty(){
      const d = DIFFS[currentDiff];
      PIPE_GAP_MIN=d.gapMin; PIPE_GAP_MAX=d.gapMax;
      PIPE_INTERVAL=d.interval; PIPE_SPEED=d.pipeSpeed; DARYA_GAIN=d.daryaGain;
    }
    applyDifficulty();

    const GRAVITY=0.0013, JUMP=-0.45, PIPE_WIDTH=110;
    const GROUND_Y = () => canvas.height - 60*DPR;

    const SKY_GRADIENT = () => {
      const g = ctx.createLinearGradient(0,0,0,canvas.height);
      g.addColorStop(0,'#60a5fa'); g.addColorStop(1,'#e0f2fe');
      return g;
    };

    let state='menu', last=performance.now(), t=0, sincePipe=0;
    let pipes=[], score=0, best=Number(localStorage.getItem('weddingChase.best')||0);
    bestEl.textContent = best;

    const player = { x: canvas.width*0.28, y: canvas.height*0.45, vy:0, r:22*DPR };
    const darya  = { x: canvas.width*0.12, y: canvas.height*0.45, vy:0, r:24*DPR };

    const ericImg = new Image();  ericImg.src  = ERIC_FACE_DATA_URL;
    const daryaImg = new Image(); daryaImg.src = DARYA_FACE_DATA_URL;

    function reset(){
      applyDifficulty();
      pipes=[]; score=0; sincePipe=0; t=0; last=performance.now();
      player.x=canvas.width*0.28; player.y=canvas.height*0.45; player.vy=0;
      darya.x=canvas.width*0.12;  darya.y=canvas.height*0.45;  darya.vy=0;
      tubeCountEl.textContent='0';
      spawnPipe(); // show a pipe immediately
    }

    function spawnPipe(){
      const gap = rand(PIPE_GAP_MIN, PIPE_GAP_MAX)*DPR;
      const center = rand(canvas.height*0.25, canvas.height*0.75);
      const topH = Math.max(20*DPR, Math.min(center - gap/2, canvas.height-120*DPR));
      const bottomY = center + gap/2;
      pipes.push({
        x: canvas.width + PIPE_WIDTH*DPR, w: PIPE_WIDTH*DPR,
        top:{y:0,h:topH}, bottom:{y:bottomY, h: GROUND_Y()-bottomY},
        passed:false
      });
    }

    function start(){
      reset();
      state='playing';
      menuHud.hidden=true; overHud.hidden=true;
      requestAnimationFrame(()=>{ menuHud.hidden=true; overHud.hidden=true; });
    }

    function gameOver(msg){
      state='over';
      overMsg.textContent = msg || 'Oops!';
      overHud.hidden=false;
      if (score>best){ best=score; localStorage.setItem('weddingChase.best', best); }
      bestEl.textContent = best;
    }

    function flap(){
      if (state==='menu'){ start(); return; }
      if (state!=='playing') return;
      player.vy = JUMP * canvas.height / 1000;
    }

    document.getElementById('btnPlay').addEventListener('click', start);
    document.getElementById('btnPlay').addEventListener('pointerdown', start);
    document.getElementById('btnRetry').addEventListener('click', start);
    document.getElementById('btnRetry').addEventListener('pointerdown', start);
    document.getElementById('btnMenu').addEventListener('click', ()=>{ state='menu'; menuHud.hidden=false; overHud.hidden=true; });
    document.getElementById('btnHow').addEventListener('click', ()=>{ const p=document.getElementById('howText'); p.hidden=!p.hidden; });

    addEventListener('keydown', e=>{
      if (e.key===' '||e.key==='ArrowUp'){ e.preventDefault(); flap(); }
      if (e.key==='p'||e.key==='P'){ if(state==='playing'){ state='paused'; } else if(state==='paused'){ state='playing'; last=performance.now(); } }
      if (e.key==='r'||e.key==='R'){ start(); }
      if (state==='over' && (e.key==='Enter' || e.key===' ')){ start(); }
    }, {passive:false});
    canvas.addEventListener('pointerdown', flap, {passive:true});

    function drawBackground(){
      ctx.fillStyle = SKY_GRADIENT(); ctx.fillRect(0,0,canvas.width,canvas.height);
      const cloudCount=6;
      for(let i=0;i<cloudCount;i++){
        const y=(i*97 + (t*0.04 + i*300))%(canvas.height*1.2)-canvas.height*0.2;
        const x=(canvas.width - ((t*0.03 + i*700)%(canvas.width+400)));
        ctx.globalAlpha=0.15; ctx.beginPath();
        ctx.arc(x, y, 70*DPR, 0, Math.PI*2);
        ctx.arc(x+50*DPR, y+10*DPR, 50*DPR, 0, Math.PI*2);
        ctx.arc(x-50*DPR, y+15*DPR, 60*DPR, 0, Math.PI*2);
        ctx.fillStyle='#fff'; ctx.fill(); ctx.globalAlpha=1;
      }
      ctx.fillStyle='#86efac'; ctx.fillRect(0, GROUND_Y(), canvas.width, canvas.height-GROUND_Y());
      ctx.fillStyle='rgba(0,0,0,.08)';
      for(let i=0;i<canvas.width;i+=40*DPR){ ctx.fillRect(i, GROUND_Y(), 20*DPR, 8*DPR); }
    }

    function drawPipes(){
      for(const p of pipes){
        const {x,w,top,bottom}=p;
        ctx.fillStyle='#16a34a';
        ctx.fillRect(x, top.y, w, top.h);
        ctx.fillRect(x, bottom.y, w, bottom.h);
        ctx.fillStyle='#22c55e';
        ctx.fillRect(x-6*DPR, top.h-12*DPR, w+12*DPR, 12*DPR);
        ctx.fillRect(x-6*DPR, bottom.y, w+12*DPR, 12*DPR);
      }
    }

    function drawFace(img, x, y, r, borderColor){
      ctx.fillStyle = 'rgba(255,255,255,.9)';
      ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
      if (img && img.complete){ ctx.save(); ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.clip(); ctx.drawImage(img, x-r, y-r, r*2, r*2); ctx.restore(); }
      ctx.lineWidth = Math.max(3*DPR, r*0.12);
      ctx.strokeStyle = borderColor;
      ctx.beginPath(); ctx.arc(x,y,r-ctx.lineWidth*0.35,0,Math.PI*2); ctx.stroke();
    }

    function drawPlayers(){
      drawFace(ericImg,  player.x, player.y, player.r, '#f59e0b');
      drawFace(daryaImg, darya.x, darya.y, darya.r, '#f43f5e');
    }

    function circleRectCollide(cx,cy,cr, rx,ry,rw,rh){
      const px = Math.max(rx, Math.min(cx, rx+rw));
      const py = Math.max(ry, Math.min(cy, ry+rh));
      const dx = cx - px, dy = cy - py;
      return (dx*dx + dy*dy) < (cr*cr);
    }

    function update(dt){
      if (state!=='playing') return;
      t += dt; sincePipe += dt;

      player.vy += 0.0013 * dt * canvas.height/1000;
      player.y  += player.vy * dt * canvas.height/1000;

      const dy = player.y - darya.y;
      darya.vy += (dy * DARYA_GAIN) * dt;
      darya.vy = clamp(darya.vy, -0.6, 0.6);
      darya.y  += darya.vy * dt * canvas.height/1000;

      for (const p of pipes){ p.x -= PIPE_SPEED * dt * canvas.width/1000; }
      if (sincePipe >= PIPE_INTERVAL){ sincePipe=0; spawnPipe(); }
      while (pipes.length && pipes[0].x + pipes[0].w < -10*DPR){ pipes.shift(); }

      for (const p of pipes){
        if (!p.passed && p.x + p.w < player.x){
          p.passed = true;
          score++;
          tubeCountEl.textContent = score;
          popEl.textContent = score;
          popEl.classList.remove('show'); void popEl.offsetWidth; popEl.classList.add('show');
        }
      }

      for (const p of pipes){
        if (circleRectCollide(player.x,player.y,player.r, p.x,p.top.y,p.w,p.top.h) ||
            circleRectCollide(player.x,player.y,player.r, p.x,p.bottom.y,p.w,p.bottom.h)){
          gameOver('Bonk! Pipe collision.'); return;
        }
      }
      if (player.y + player.r > GROUND_Y()){ gameOver('Ouch! Hit the ground.'); return; }
      if (player.y - player.r < 0){ player.y = player.r; player.vy = 0; }

      const dx = player.x - darya.x, ddy = player.y - darya.y;
      const d2 = dx*dx + ddy*ddy, catchDist = (player.r + darya.r + 10*DPR);
      if (d2 < catchDist*catchDist){ gameOver('Darya caught you! 💖'); return; }
    }

    function render(){
      ctx.fillStyle = SKY_GRADIENT(); ctx.fillRect(0,0,canvas.width,canvas.height);
      drawPipes(); drawPlayers();
      ctx.fillStyle='#86efac'; ctx.fillRect(0, GROUND_Y(), canvas.width, canvas.height-GROUND_Y());
      ctx.fillStyle='rgba(0,0,0,.08)'; for(let i=0;i<canvas.width;i+=40*DPR){ ctx.fillRect(i, GROUND_Y(), 20*DPR, 8*DPR); }
    }

    function loop(now){
      const dt = now - last; last = now;
      if (state==='playing') update(dt);
      render();
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);
  })();
  </script>
</body>
</html>
