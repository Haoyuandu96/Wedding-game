<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Eric & Darya: Wedding Chase</title>
  <style>
    :root{ --bg1:#0f172a; --bg2:#1e293b; --text:#e5e7eb; --shadow:rgba(0,0,0,.35); }
    *{box-sizing:border-box}
    html,body{
      height:100%; margin:0;
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text);
    }
    .wrap{display:flex;align-items:center;justify-content:center;height:100%;padding:16px}
    canvas{
      width:min(100%,900px); aspect-ratio:9/16;
      border-radius:20px; box-shadow:0 20px 60px var(--shadow);
      background:linear-gradient(180deg,#60a5fa,#e0f2fe); touch-action:none
    }

    .hud{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:10;}
    .hud[hidden]{display:none !important;}
    .card{
      background:rgba(17,24,39,.85); backdrop-filter:blur(8px);
      border:1px solid rgba(255,255,255,.08);
      padding:20px 22px; border-radius:16px; width:min(92vw,560px);
      box-shadow:0 10px 40px var(--shadow)
    }
    .title{font-size:24px;font-weight:800;margin:0 0 6px;text-align:center}
    .subtitle{font-size:14px;opacity:.8;text-align:center;margin:0 0 14px}
    .btnrow{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
    button{
      background:#fff;color:#111;font-weight:700;padding:12px 18px;border-radius:999px;border:0;cursor:pointer;
      box-shadow:0 8px 24px var(--shadow)
    }
    button.secondary{background:transparent;color:#fff;border:1px solid rgba(255,255,255,.2)}
    .small{font-size:12px;opacity:.9;text-align:center;margin-top:8px}
    fieldset{border:1px solid rgba(255,255,255,.15); border-radius:12px; padding:10px 12px; margin:10px 0}
    legend{font-size:12px; opacity:.8; padding:0 6px}

    .top-center{position:fixed;left:50%;transform:translateX(-50%);top:10px;font-weight:800;z-index:2}
    .top-right{position:fixed;right:14px;top:10px;opacity:.9;z-index:2}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.12);margin-left:6px}

    .popScore{
      position:fixed; left:50%; transform:translateX(-50%);
      top:58px; font-size:56px; font-weight:900; color:#fff;
      text-shadow:0 6px 24px rgba(0,0,0,.35);
      opacity:0; pointer-events:none; z-index:2;
    }
    .popScore.show{ animation:pop 750ms ease-out forwards; }
    @keyframes pop{
      0% { transform:translateX(-50%) scale(.6); opacity:0 }
      20%{ opacity:1 }
      60%{ transform:translateX(-50%) scale(1) }
      100%{ opacity:0 }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <canvas id="game" width="900" height="1600" aria-label="Game canvas"></canvas>
  </div>

  <div class="top-center">Tubes: <span id="tubeCount">0</span> <span class="pill">Best: <span id="best">0</span></span></div>
  <div class="top-right"><span class="pill">Tap/Click/Space to flap · P to pause · R to restart</span></div>
  <div id="pop" class="popScore">1</div>

  <div class="hud" id="menuHud">
    <div class="card">
      <h1 class="title">Eric &amp; Darya: Wedding Chase</h1>
      <p class="subtitle">Flap through pipes as <strong>Eric</strong>; don’t let <strong>Darya</strong> catch you!</p>

      <fieldset>
        <legend>Difficulty</legend>
        <label><input type="radio" name="diff" value="Easy"> Easy</label>
        <label style="margin-left:10px"><input type="radio" name="diff" value="Normal" checked> Normal</label>
        <label style="margin-left:10px"><input type="radio" name="diff" value="Hard"> Hard</label>
        <div class="small" style="margin-top:6px;opacity:.8">
          Easy = bigger gaps & slower chase · Hard = tighter gaps & faster chase
        </div>
      </fieldset>

      <div class="btnrow">
        <button id="btnPlay" type="button">Start</button>
        <button class="secondary" id="btnHow" type="button">How to play</button>
      </div>
      <p class="small" id="howText" hidden>
        Fly between pipe gaps to score. If you hit a pipe, the ground, or if Darya catches you, it’s game over.
        Choose your difficulty above — it’ll be remembered for next time.
      </p>
    </div>
  </div>

  <div class="hud" id="overHud" hidden>
    <div class="card">
      <h2 class="title">Game Over</h2>
      <p class="subtitle" id="overMsg">So close! Wanna try again?</p>
      <div class="btnrow">
        <button id="btnRetry" type="button">Play again</button>
        <button class="secondary" id="btnMenu" type="button">Main menu</button>
      </div>
      <p class="small">Tip: quick restart with the <strong>R</strong> key.</p>
    </div>
  </div>

  <script>
  (()=> {
    /* Embedded faces (WebP, 160x160) */
    const ERIC_FACE_DATA_URL =
      "data:image/webp;base64,UklGRg4RAABXRUJQVlA4IAIRAABwSgCdASqgAKAAAPQGACGkKIlKvU9nAA3kK+v8PRX0zUGV8J7R0YH8Y3Fltm4/4K8mu9jzGQJb8hXJ8w1o8pUkv7J6rj1dUqZf+4K1iY4oHUPHhWkQ0+q6h7lQK0u+6r0aS3ZpQx2A0a4yJ9mW3m1fVVCvH1TqU3e4y2v0dQAtmNwR8a7cUO8c4F2mAH1rI2a9tM8bM2oI/xY0uE7T1Bxfyq8xj7ZbVwBms3+iI6WJpW8K7t6ybqkUSv3guv0v0E5NnF5mQb8z8gM0GJz2Jm6cIDiW9kX4cztxT74Kk5o8g7f0s8QK2LGF6xwS67XHj/5xTjzWl8K5gJ0X4w1sV6qM1h3xj3Xo6aU4q2m3Rz3m0c2s3S8Hc1Vn6P0o8wZ0O3n9m2ZKkzt0c0cwnZjItr9zQoooUmx91DMKMraLmYXTWtu/rrHfQAA";
    const DARYA_FACE_DATA_URL =
      "data:image/webp;base64,UklGRuAQAABXRUJQVlA4INQQAADwSgCdASqgAKAAAPYHACPh3oJv8h8cABGCGqOZ1Y/7G1m4F2QW4a2oG4QvJ9G5HmoWJ6YlK3S0QXv4Q1b3o0zv8s6mXK8bxTzHk7dZ9reEnEXdq3nL3t7C4r8ZrGf9xQ0Hn9cQ6H1w2qQ9J5rDX3X0yF2d2FivY5yFOQm3a0pZ9qk0b8i4m0P0mL5qfO3iZk8w3lGm3B3gE5Yc7s6m2m2Ue5ZCNw2tU8r2s1B4pVf7l5F3V6mWkJztrO1d7W1b6n4l0e0vQ8j5m8O7vyO43rBdNr40C+o+N+RaIo1zSIpRKY6a1wrAAA=";

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const tubeCountEl = document.getElementById('tubeCount');
    const bestEl  = document.getElementById('best');
    const menuHud = document.getElementById('menuHud');
    const overHud = document.getElementById('overHud');
    const overMsg = document.getElementById('overMsg');
    const popEl   = document.getElementById('pop');
    const diffRadios = Array.from(document.querySelectorAll('input[name="diff"]'));

    const DPR = Math.max(1, Math.min(window.devicePixelRatio || 1, 2));
    function resize(){
      const w = Math.min(window.innerWidth - 32, 900);
      const h = Math.round(w * 16/9);
      canvas.style.width = w + 'px';
      canvas.style.height = h + 'px';
      canvas.width  = Math.floor(w * DPR);
      canvas.height = Math.floor(h * DPR);
    }
    addEventListener('resize', resize, {passive:true}); resize();

    const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
    const rand=(a,b)=>a+Math.random()*(b-a);

    const DIFFS = {
      Easy:   { gapMin:320, gapMax:380, interval:2100, daryaGain:0.00045, pipeSpeed:0.25 },
      Normal: { gapMin:260, gapMax:320, interval:1900, daryaGain:0.00060, pipeSpeed:0.26 },
      Hard:   { gapMin:200, gapMax:240, interval:1500, daryaGain:0.00075, pipeSpeed:0.29 },
    };
    let currentDiff = localStorage.getItem('weddingChase.diff') || 'Normal';
    if (!DIFFS[currentDiff]) currentDiff = 'Normal';
    diffRadios.forEach(r => r.checked = (r.value === currentDiff));
    diffRadios.forEach(r => r.addEventListener('change', () => {
      if (r.checked) {
        currentDiff = r.value;
        localStorage.setItem('weddingChase.diff', currentDiff);
      }
    }));

    let PIPE_GAP_MIN=260, PIPE_GAP_MAX=320, PIPE_INTERVAL=1900, PIPE_SPEED=0.26, DARYA_GAIN=0.0006;
    function applyDifficulty(){
      const d = DIFFS[currentDiff];
      PIPE_GAP_MIN=d.gapMin; PIPE_GAP_MAX=d.gapMax;
      PIPE_INTERVAL=d.interval; PIPE_SPEED=d.pipeSpeed; DARYA_GAIN=d.daryaGain;
    }
    applyDifficulty();

    const GRAVITY=0.0013, JUMP=-0.45, PIPE_WIDTH=110;
    const GROUND_Y = () => canvas.height - 60*DPR;

    const SKY_GRADIENT = () => {
      const g = ctx.createLinearGradient(0,0,0,canvas.height);
      g.addColorStop(0,'#60a5fa'); g.addColorStop(1,'#e0f2fe');
      return g;
    };

    let state='menu', last=performance.now(), t=0, sincePipe=0;
    let pipes=[], score=0, best=Number(localStorage.getItem('weddingChase.best')||0);
    bestEl.textContent = best;

    const player = { x: canvas.width*0.28, y: canvas.height*0.45, vy:0, r:22*DPR };
    const darya  = { x: canvas.width*0.12, y: canvas.height*0.45, vy:0, r:24*DPR };

    const ericImg = new Image();  ericImg.src  = ERIC_FACE_DATA_URL;
    const daryaImg = new Image(); daryaImg.src = DARYA_FACE_DATA_URL;

    function reset(){
      applyDifficulty();
      pipes=[]; score=0; sincePipe=0; t=0; last=performance.now();
      player.x=canvas.width*0.28; player.y=canvas.height*0.45; player.vy=0;
      darya.x=canvas.width*0.12;  darya.y=canvas.height*0.45;  darya.vy=0;
      tubeCountEl.textContent='0';
      // show a pipe immediately so it's not just sky
      spawnPipe();
    }

    function spawnPipe(){
      const gap = rand(PIPE_GAP_MIN, PIPE_GAP_MAX)*DPR;
      const center = rand(canvas.height*0.25, canvas.height*0.75);
      const topH = Math.max(20*DPR, Math.min(center - gap/2, canvas.height-120*DPR));
      const bottomY = center + gap/2;
      pipes.push({
        x: canvas.width + PIPE_WIDTH*DPR, w: PIPE_WIDTH*DPR,
        top:{y:0,h:topH}, bottom:{y:bottomY, h: GROUND_Y()-bottomY},
        passed:false
      });
    }

    function start(){
      reset();
      state='playing';
      menuHud.hidden=true; overHud.hidden=true;
      requestAnimationFrame(()=>{ menuHud.hidden=true; overHud.hidden=true; });
    }

    function gameOver(msg){
      state='over';
      overMsg.textContent = msg || 'Oops!';
      overHud.hidden=false;
      if (score>best){ best=score; localStorage.setItem('weddingChase.best', best); }
      bestEl.textContent = best;
    }

    function flap(){
      if (state==='menu'){ start(); return; }
      if (state!=='playing') return;
      player.vy = JUMP * canvas.height / 1000;
    }

    document.getElementById('btnPlay').addEventListener('click', start);
    document.getElementById('btnPlay').addEventListener('pointerdown', start);
    document.getElementById('btnRetry').addEventListener('click', start);
    document.getElementById('btnRetry').addEventListener('pointerdown', start);
    document.getElementById('btnMenu').addEventListener('click', ()=>{ state='menu'; menuHud.hidden=false; overHud.hidden=true; });
    document.getElementById('btnHow').addEventListener('click', ()=>{ const p=document.getElementById('howText'); p.hidden=!p.hidden; });

    addEventListener('keydown', e=>{
      if (e.key===' '||e.key==='ArrowUp'){ e.preventDefault(); flap(); }
      if (e.key==='p'||e.key==='P'){ if(state==='playing'){ state='paused'; } else if(state==='paused'){ state='playing'; last=performance.now(); } }
      if (e.key==='r'||e.key==='R'){ start(); }
      if (state==='over' && (e.key==='Enter' || e.key===' ')){ start(); }
    }, {passive:false});
    canvas.addEventListener('pointerdown', flap, {passive:true});

    function drawBackground(){
      ctx.fillStyle = SKY_GRADIENT(); ctx.fillRect(0,0,canvas.width,canvas.height);
      const cloudCount=6;
      for(let i=0;i<cloudCount;i++){
        const y=(i*97 + (t*0.04 + i*300))%(canvas.height*1.2)-canvas.height*0.2;
        const x=(canvas.width - ((t*0.03 + i*700)%(canvas.width+400)));
        ctx.globalAlpha=0.15; ctx.beginPath();
        ctx.arc(x, y, 70*DPR, 0, Math.PI*2);
        ctx.arc(x+50*DPR, y+10*DPR, 50*DPR, 0, Math.PI*2);
        ctx.arc(x-50*DPR, y+15*DPR, 60*DPR, 0, Math.PI*2);
        ctx.fillStyle='#fff'; ctx.fill(); ctx.globalAlpha=1;
      }
      ctx.fillStyle='#86efac'; ctx.fillRect(0, GROUND_Y(), canvas.width, canvas.height-GROUND_Y());
      ctx.fillStyle='rgba(0,0,0,.08)';
      for(let i=0;i<canvas.width;i+=40*DPR){ ctx.fillRect(i, GROUND_Y(), 20*DPR, 8*DPR); }
    }

    function drawPipes(){
      for(const p of pipes){
        const {x,w,top,bottom}=p;
        ctx.fillStyle='#16a34a';
        ctx.fillRect(x, top.y, w, top.h);
        ctx.fillRect(x, bottom.y, w, bottom.h);
        ctx.fillStyle='#22c55e';
        ctx.fillRect(x-6*DPR, top.h-12*DPR, w+12*DPR, 12*DPR);
        ctx.fillRect(x-6*DPR, bottom.y, w+12*DPR, 12*DPR);
      }
    }

    function drawFace(img, x, y, r, borderColor){
      // fallback background circle so you always see something
      ctx.fillStyle = 'rgba(255,255,255,.9)';
      ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();

      if (img && img.complete){
        ctx.save();
        ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.clip();
        ctx.drawImage(img, x-r, y-r, r*2, r*2);
        ctx.restore();
      }
      // border ring
      ctx.lineWidth = Math.max(3*DPR, r*0.12);
      ctx.strokeStyle = borderColor;
      ctx.beginPath(); ctx.arc(x,y,r-ctx.lineWidth*0.35,0,Math.PI*2); ctx.stroke();
    }

    function drawPlayers(){
      drawFace(ericImg,  player.x, player.y, player.r, '#f59e0b'); // Eric
      drawFace(daryaImg, darya.x, darya.y, darya.r, '#f43f5e');    // Darya
    }

    function circleRectCollide(cx,cy,cr, rx,ry,rw,rh){
      const px = Math.max(rx, Math.min(cx, rx+rw));
      const py = Math.max(ry, Math.min(cy, ry+rh));
      const dx = cx - px, dy = cy - py;
      return (dx*dx + dy*dy) < (cr*cr);
    }

    function update(dt){
      if (state!=='playing') return;
      t += dt; sincePipe += dt;

      player.vy += 0.0013 * dt * canvas.height/1000;
      player.y  += player.vy * dt * canvas.height/1000;

      const dy = player.y - darya.y;
      darya.vy += (dy * (0.0006 + (DARYA_GAIN-0.0006))) * dt;
      darya.vy = clamp(darya.vy, -0.6, 0.6);
      darya.y  += darya.vy * dt * canvas.height/1000;

      for (const p of pipes){ p.x -= PIPE_SPEED * dt * canvas.width/1000; }
      if (sincePipe >= PIPE_INTERVAL){ sincePipe=0; spawnPipe(); }
      while (pipes.length && pipes[0].x + pipes[0].w < -10*DPR){ pipes.shift(); }

      for (const p of pipes){
        if (!p.passed && p.x + p.w < player.x){
          p.passed = true;
          score++;
          tubeCountEl.textContent = score;
          popEl.textContent = score;
          popEl.classList.remove('show'); void popEl.offsetWidth; popEl.classList.add('show');
        }
      }

      for (const p of pipes){
        if (circleRectCollide(player.x,player.y,player.r, p.x,p.top.y,p.w,p.top.h) ||
            circleRectCollide(player.x,player.y,player.r, p.x,p.bottom.y,p.w,p.bottom.h)){
          gameOver('Bonk! Pipe collision.'); return;
        }
      }
      if (player.y + player.r > GROUND_Y()){ gameOver('Ouch! Hit the ground.'); return; }
      if (player.y - player.r < 0){ player.y = player.r; player.vy = 0; }

      const dx = player.x - darya.x, ddy = player.y - darya.y;
      const d2 = dx*dx + ddy*ddy, catchDist = (player.r + darya.r + 10*DPR);
      if (d2 < catchDist*catchDist){ gameOver('Darya caught you! 💖'); return; }
    }

    function render(){
      ctx.fillStyle = SKY_GRADIENT(); ctx.fillRect(0,0,canvas.width,canvas.height);
      drawPipes(); drawPlayers();
      ctx.fillStyle='#86efac'; ctx.fillRect(0, GROUND_Y(), canvas.width, canvas.height-GROUND_Y());
      ctx.fillStyle='rgba(0,0,0,.08)'; for(let i=0;i<canvas.width;i+=40*DPR){ ctx.fillRect(i, GROUND_Y(), 20*DPR, 8*DPR); }
    }

    function loop(now){
      const dt = now - last; last = now;
      if (state==='playing') update(dt);
      render();
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);
  })();
  </script>
</body>
</html>
